<!-- מערכת הודעות -->
<div class="notifications-container">
    <div *ngFor="let notification of notifications" class="notification" [class]="'notification--' + notification.type"
        [class.notification--visible]="notification.visible" (click)="removeNotification(notification.id)">
        <div class="notification-content">
            <svg class="notification-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path *ngIf="notification.type === 'success'"
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                <path *ngIf="notification.type === 'error'"
                    d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" />
                <path *ngIf="notification.type === 'info'"
                    d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,17A1.5,1.5 0 0,1 10.5,15.5A1.5,1.5 0 0,1 12,14A1.5,1.5 0 0,1 13.5,15.5A1.5,1.5 0 0,1 12,17M12,10A1,1 0 0,1 11,9V7A1,1 0 0,1 12,6A1,1 0 0,1 13,7V9A1,1 0 0,1 12,10Z" />
            </svg>
            <span class="notification-message">{{notification.message}}</span>
            <button class="notification-close" (click)="removeNotification(notification.id); $event.stopPropagation()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                </svg>
            </button>
        </div>
    </div>
</div>

<div class="app-layout">
    <!-- כפתור חזרה קבוע -->
    <button class="back-button-fixed" (click)="navigateToHome()" title="חזרה לעמוד הראשי">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
        </svg>
    </button>

    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <h1 class="app-title">
                    <svg class="app-icon" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z" />
                    </svg>
                    מערכת הוצאות - הנהלת חשבונות
                </h1>
                <nav class="nav-menu">
                    <button class="nav-button" [class.active]="currentTab === 'newExpense'"
                        (click)="setCurrentTab('newExpense')">
                        הוצאה חדשה
                    </button>
                    <button class="nav-button" [class.active]="currentTab === 'expenses'"
                        (click)="setCurrentTab('expenses')">
                        רשימת הוצאות
                    </button>
                    <button class="nav-button" [class.active]="currentTab === 'suppliers'"
                        (click)="setCurrentTab('suppliers')">
                        ספקים
                    </button>
                    <button class="nav-button" [class.active]="currentTab === 'settings'"
                        (click)="setCurrentTab('settings')">
                        הגדרות
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">

            <!-- הוצאה חדשה -->
            <div *ngIf="currentTab === 'newExpense'" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">הוצאה חדשה</h2>
                    </div>
                    <div class="card-body">
                        <form (ngSubmit)="saveExpense()" #expenseForm="ngForm">

                            <div class="form-grid">
                                <!-- מספר אסמכתא -->
                                <div class="form-group">
                                    <label for="referenceNumber">מספר אסמכתא</label>
                                    <input type="text" id="referenceNumber" [(ngModel)]="newExpense.referenceNumber"
                                        name="referenceNumber">
                                </div>

                                <!-- תאריך -->
                                <div class="form-group">
                                    <label for="date">תאריך</label>
                                    <input type="date" id="date" [(ngModel)]="newExpense.date" name="date" required>
                                </div>

                                <!-- ספק -->
                                <div class="form-group">
                                    <label for="supplier">ספק</label>
                                    <div class="client-selection">
                                        <select id="supplier" [(ngModel)]="newExpense.supplierId" name="supplier"
                                            required (change)="onSupplierChange()">
                                            <option value="">בחר ספק</option>
                                            <option *ngFor="let supplier of suppliers" [value]="supplier.id">
                                                {{supplier.name}}
                                            </option>
                                        </select>
                                    </div>
                                </div>

                                <!-- קטגוריה -->
                                <div class="form-group">
                                    <label for="category">קטגוריה</label>
                                    <select id="category" [(ngModel)]="newExpense.category" name="category" required>
                                        <option value="">בחר קטגוריה</option>
                                        <option *ngFor="let cat of categories" [value]="cat">{{cat}}</option>
                                    </select>
                                </div>

                                <!-- סכום -->
                                <div class="form-group">
                                    <label for="amount">סכום כולל מע"מ</label>
                                    <input type="number" id="amount" [(ngModel)]="newExpense.amount" name="amount"
                                        step="0.01" required>
                                </div>

                                <!-- מע"מ -->
                                <div class="form-group">
                                    <label for="vatRate">מע"מ</label>
                                    <select id="vatRate" [(ngModel)]="newExpense.vatRate" name="vatRate">
                                        <option [value]="0">ללא מע"מ</option>
                                        <option [value]="settings.defaultVatRate">{{settings.defaultVatRate}}%</option>
                                    </select>
                                </div>

                                <!-- אופן תשלום -->
                                <div class="form-group full-width">
                                    <label>אופן תשלום</label>
                                    <div class="payment-methods">
                                       
                                        <label class="radio-option">
                                            <input type="radio" [(ngModel)]="newExpense.paymentMethod"
                                                name="paymentMethod" value="cash">
                                            <span>מזומן</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" [(ngModel)]="newExpense.paymentMethod"
                                                name="paymentMethod" value="credit">
                                            <span>אשראי</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" [(ngModel)]="newExpense.paymentMethod"
                                                name="paymentMethod" value="check">
                                            <span>צ'ק</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" [(ngModel)]="newExpense.paymentMethod"
                                                name="paymentMethod" value="transfer">
                                            <span>העברה בנקאית</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- פרטים -->
                                <div class="form-group full-width">
                                    <label for="details">פרטים</label>
                                    <textarea id="details" [(ngModel)]="newExpense.details" name="details"
                                        rows="2"></textarea>
                                </div>
                            </div>

                            <!-- כפתורים -->
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" [disabled]="!expenseForm.form.valid">
                                    שמור הוצאה
                                </button>
                                <button type="button" class="btn btn-outline" (click)="resetForm()">
                                    נקה טופס
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- רשימת הוצאות -->
            <div *ngIf="currentTab === 'expenses'" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">רשימת הוצאות</h2>
                    </div>
                    <div class="header-actions">
                        <input type="text" placeholder="חיפוש" [(ngModel)]="searchTerm" class="search-input">
                    </div>

                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>מספר אסמכתא</th>
                                        <th>תאריך</th>
                                        <th>ספק</th>
                                        <th>סכום</th>
                                        <th>אופן תשלום</th>
                                        <th>פעולות</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let expense of expenses">
                                        <td>{{expense.referenceNumber}}</td>
                                        <td>{{expense.date | date:'dd/MM/yyyy'}}</td>
                                        <td>{{expense.supplierName}}</td>
                                        <td>{{expense.amount | number:'1.2-2'}} ₪</td>
                                        <td>{{getPaymentMethodName(expense.paymentMethod)}}</td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn btn-sm btn-outline" (click)="editExpense(expense)">
                                                    עריכה
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div *ngIf="expenses.length === 0" class="no-data">אין הוצאות להצגה</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ספקים -->
            <div *ngIf="currentTab === 'suppliers'" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">מאגר ספקים</h2>
                        <button class="btn btn-primary" (click)="showNewSupplierForm = true">
                            + ספק חדש
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- טופס ספק חדש -->
                        <div *ngIf="showNewSupplierForm" class="new-supplier-form">
                            <h3>ספק חדש</h3>
                            <form (ngSubmit)="saveSupplier()" #supplierForm="ngForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="supplierName">שם ספק</label>
                                        <input type="text" id="supplierName" [(ngModel)]="newSupplier.name"
                                            name="supplierName" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="supplierPhone">טלפון</label>
                                        <input type="tel" id="supplierPhone" [(ngModel)]="newSupplier.phone"
                                            name="supplierPhone">
                                    </div>
                                    <div class="form-group">
                                        <label for="supplierEmail">אימייל</label>
                                        <input type="email" id="supplierEmail" [(ngModel)]="newSupplier.email"
                                            name="supplierEmail">
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="supplierAddress">כתובת</label>
                                        <textarea id="supplierAddress" [(ngModel)]="newSupplier.address"
                                            name="supplierAddress" rows="2"></textarea>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary" [disabled]="!supplierForm.form.valid">
                                        שמור ספק
                                    </button>
                                    <button type="button" class="btn btn-outline" (click)="showNewSupplierForm = false">
                                        ביטול
                                    </button>
                                </div>
                            </form>
                        </div>
                        <!-- רשימת ספקים -->
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>שם</th>
                                        <th>טלפון</th>
                                        <th>אימייל</th>
                                        <th>כתובת</th>
                                        <th>פעולות</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let supplier of suppliers">
                                        <td>{{supplier.name}}</td>
                                        <td>{{supplier.phone}}</td>
                                        <td>{{supplier.email}}</td>
                                        <td>{{supplier.address}}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline" (click)="editSupplier(supplier)">
                                                עריכה
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div *ngIf="suppliers.length === 0" class="no-data">אין ספקים במאגר</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="currentTab === 'settings'" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">הגדרות מערכת</h2>
                </div>
                <div class="card-body">
                    <div class="settings-section">
                        <h3>הגדרות מע"מ</h3>
                        <div class="form-group">
                            <label for="defaultVatRate">אחוז מע"מ ברירת מחדל</label>
                            <input type="number" id="defaultVatRate" [(ngModel)]="settings.defaultVatRate" step="0.01"
                                (change)="saveSettings()">
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>הגדרות אסמכתות</h3>
                        <div class="form-group">
                            <label for="expensePrefix">קידומת מספר אסמכתא</label>
                            <input type="text" id="expensePrefix" [(ngModel)]="settings.expensePrefix"
                                (change)="saveSettings()">
                        </div>
                        <div class="form-group">
                            <label for="nextExpenseNumber">מספר אסמכתא הבא</label>
                            <input type="number" id="nextExpenseNumber" [(ngModel)]="settings.nextExpenseNumber"
                                (change)="saveSettings()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>