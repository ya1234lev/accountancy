<section class="card">
  <div class="card-header">
    <h3 class="card-title">
      <svg class="card-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
      </svg>
      הוספת עסקה חדשה
    </h3>
  </div>
  <div class="card-body">
    <form (ngSubmit)="onSubmit()" class="form">
      <div class="form-row">
        <div class="form-group">
          <label for="type" class="form-label">סוג עסקה</label>
          <select id="type" [(ngModel)]="newTransaction.type" name="type" required class="form-select">
            <option value="income">הכנסה</option>
            <option value="expense">הוצאה</option>
          </select>
        </div>
        <div class="form-group">
          <label for="date" class="form-label">תאריך עסקה</label>
          <input id="date" type="date" [(ngModel)]="newTransaction.date" name="date" required class="form-input" (ngModelChange)="onDueDateChange()">
        </div>
      </div>

      <div class="form-row" *ngIf="newTransaction.type === 'income'">
        <div class="form-group">
          <label for="client" class="form-label">לקוח</label>
          <input id="client" list="customers-list" [(ngModel)]="newTransaction.client" name="client" required class="form-input" placeholder="בחר או כתוב שם לקוח...">
          <datalist id="customers-list">
            <option *ngFor="let c of customers" [value]="c">{{c}}</option>
          </datalist>
        </div>
        <!-- <div class="form-group">
          <label for="amount" class="form-label">סכום (₪)</label>
          <input id="amount" type="number" [(ngModel)]="newTransaction.amount" name="amount" required step="0.01" min="0" placeholder="0.00" class="form-input">
        </div> -->
      </div>

      <div class="form-row" *ngIf="newTransaction.type === 'expense'">
        <div class="form-group">
          <label for="supplier" class="form-label">ספק</label>
          <select id="supplier" [(ngModel)]="newTransaction.client" name="client" required class="form-select">
            <option value="" disabled selected>בחר ספק</option>
            <option *ngFor="let s of suppliers" [value]="s">{{s}}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="category" class="form-label">קטגוריה</label>
          <select id="category" [(ngModel)]="newTransaction.category" name="category" required class="form-select">
            <option value="" disabled selected>בחר קטגוריה</option>
            <option *ngFor="let cat of categories" [value]="cat">{{cat}}</option>
          </select>
        </div>
      </div>

      <!-- <div class="form-row" *ngIf="newTransaction.type === 'expense'">
        <div class="form-group">
          <label for="amount-exp" class="form-label">סכום (₪)</label>
          <input id="amount-exp" type="number" [(ngModel)]="newTransaction.amount" name="amount" required step="0.01" min="0" placeholder="0.00" class="form-input">
        </div>
      </div> -->

      <div class="form-group">
        <label for="paymentMethod" class="form-label">אופן התשלום</label>
        <select id="paymentMethod" [(ngModel)]="paymentMethod" name="paymentMethod" required class="form-select">
          <option value="cash">מזומן</option>
          <option value="credit">אשראי</option>
          <option value="check">צ'ק</option>
          <option value="bank">העברה בנקאית</option>
        </select>
      </div>

      <!-- שדות דינמיים לפי אופן התשלום -->
      <div *ngIf="paymentMethod === 'cash'" class="form-group">
        <label class="form-label">סכום</label>
        <input type="number" [(ngModel)]="paymentDetails.amount" name="cashAmount" class="form-input" placeholder="סכום במזומן">
      </div>
      <div *ngIf="paymentMethod === 'credit'" class="form-row">
        <div class="form-group">
          <label class="form-label">4 ספרות אחרונות</label>
          <input type="text" maxlength="4" [(ngModel)]="paymentDetails.last4" name="creditLast4" class="form-input" placeholder="1234">
        </div>
        <div class="form-group">
          <label class="form-label">סכום</label>
          <input type="number" [(ngModel)]="paymentDetails.amount" name="creditAmount" class="form-input" placeholder="סכום באשראי">
        </div>
        <div class="form-group">
          <label class="form-label">מספר תשלומים</label>
          <input type="number" [(ngModel)]="paymentDetails.payments" name="creditPayments" class="form-input" placeholder="1">
        </div>
      </div>
      <div *ngIf="paymentMethod === 'check' || paymentMethod === 'bank'" class="form-row">
        <div class="form-group">
          <label class="form-label">מספר</label>
          <input type="text" [(ngModel)]="paymentDetails.number" name="checkNumber" class="form-input" placeholder="מספר צ'ק/העברה">
        </div>
        <div class="form-group">
          <label class="form-label">מספר חשבון</label>
          <input type="text" [(ngModel)]="paymentDetails.account" name="checkAccount" class="form-input" placeholder="123456">
        </div>
        <div class="form-group">
          <label class="form-label">מספר בנק</label>
          <input type="text" [(ngModel)]="paymentDetails.bank" name="checkBank" class="form-input" placeholder="12">
        </div>
        <div class="form-group">
          <label class="form-label">סכום</label>
          <input type="number" [(ngModel)]="paymentDetails.amount" name="checkAmount" class="form-input" placeholder="סכום">
        </div>
        <div class="form-group">
          <label class="form-label">תאריך פירעון</label>
          <input type="date" [(ngModel)]="paymentDetails.dueDate" name="checkDueDate" class="form-input" (ngModelChange)="onDueDateChange()">
          <div *ngIf="errorMessage" class="error-message" style="color: #b71c1c; font-size: 0.95em; margin-top: 0.25rem; font-family: inherit;">
            {{ errorMessage }}
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="description" class="form-label">פרטים</label>
        <input id="description" type="text" [(ngModel)]="newTransaction.description" name="description" placeholder="הזן פרטים נוספים" class="form-input">
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn--primary" [disabled]="errorMessage">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17,9H7V7H17M17,13H7V11H17M14,17H7V15H14M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M19,3H14.82C14.4,1.84 13.3,1 12,1C10.7,1 9.6,1.84 9.18,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3Z"/>
          </svg>
          שמור עסקה
        </button>
      </div>
  <!-- הודעת שגיאה מוצגת כעת מתחת לשדה תאריך פירעון בלבד -->
    </form>
  </div>
</section>
